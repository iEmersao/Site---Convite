<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Convite para o ChurrascÃ£o da Rafa â€” confirme presenÃ§a e veja o local" />
  <title>Churras da Rafa</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: url('https://images.unsplash.com/photo-1555992336-cbf97e6f2c36?auto=format&fit=crop&w=1200&q=80') center/cover no-repeat fixed;
      padding: 0;
      color: #fff;
    }
    .bg-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; filter: brightness(60%); }
    .overlay { background: rgba(0,0,0,0.55); width: 100%; min-height: 100vh; padding: 20px; position: relative; z-index: 1; }
    .container { max-width: 700px; margin: auto; background: rgba(0,0,0,0.65); padding: 25px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.6); }
    h1 { text-align: center; font-size: 2.2rem; margin-bottom: 10px; color: #ffb347; }
    .info { font-size: 1.1rem; margin-bottom: 20px; line-height: 1.6; }
    label { font-weight: bold; font-size: 1.1rem; display:block; margin-top:8px; }
    input, select, textarea { width: 100%; padding: 10px; border-radius: 8px; border: none; margin-top: 6px; margin-bottom: 15px; font-size: 1rem; }
    button { width: 100%; background: #ff9100; border: none; padding: 12px; color: #fff; font-size: 1.1rem; border-radius: 8px; cursor: pointer; margin-bottom: 20px; transition: 0.2s; }
    button:hover { background: #ffa733; }
    .card { background: rgba(255,255,255,0.12); padding: 15px; border-radius: 10px; margin-bottom: 12px; position: relative; }
    .deleteBtn { position: absolute; top: 10px; right: 10px; background: #ff4444; padding: 6px 10px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; }
    .deleteBtn:hover { background: #ff6666; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    .item { animation: fadeIn 0.35s ease forwards; }
    @media (max-width: 600px) { h1 { font-size: 1.6rem; } .container { padding: 15px; } button { font-size: 1rem; padding: 10px; } }
    .countdown { text-align: center; font-size: 1.2rem; margin-bottom: 20px; }
    .audio-tip { text-align: center; margin: 15px 0; color: #ffb347; font-size: 1rem; }
    .sr-only { position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden; }
  </style>
</head>
<body>

<!-- VÃ­deo de fundo -->
<video class="bg-video" autoplay loop muted playsinline aria-hidden="true">
  <source src="https://cdn.videvo.net/videvo_files/video/free/2014-12/large_watermarked/Hands_Beer04Videvo_preview.mp4" type="video/mp4">
</video>

<div class="overlay">
  <div class="container">
    <h1>ğŸ”¥ ChurrascÃ£o da Rafa</h1>

    <div class="countdown" id="countdown">â³ Contagem regressiva...</div>

    <div class="info" aria-live="polite">
      ğŸ“ <strong>EndereÃ§o:</strong> Rua Georgina de Albuquerque, 196<br>
      ğŸ“… <strong>Data:</strong> 13 de Dezembro<br>
      â° <strong>HorÃ¡rio:</strong> A partir das 19h<br><br>
      Traga sua bebida de preferÃªncia! ğŸ˜„ğŸ»ğŸ”¥
    </div>

    <!-- Mapa do local: substitua o src pelo embed correto do Google Maps para o endereÃ§o desejado -->
    <iframe
      src="https://www.google.com/maps?q=Rua+Georgina+de+Albuquerque,+196&output=embed"
      width="100%" height="250" style="border:0; border-radius:10px; margin-bottom:20px;" allowfullscreen loading="lazy" title="Mapa do local" referrerpolicy="no-referrer-when-downgrade">
    </iframe>

    <!-- MÃºsica brasileira -->
    <!-- OBS: se nÃ£o houver o arquivo samba.mp3 no repositÃ³rio, substitua o src por uma URL pÃºblica ou faÃ§a upload do arquivo -->
    <audio id="musica" loop preload="metadata">
      <source src="samba.mp3" type="audio/mpeg">
      Seu navegador nÃ£o suporta Ã¡udio.
    </audio>
    <div class="audio-tip">
      ğŸµ
      <button type="button" id="play-music-btn" aria-pressed="false" aria-label="Tocar mÃºsica">â–¶ï¸ Tocar MÃºsica</button>
    </div>

    <label for="nome">Seu nome:</label>
    <input type="text" id="nome" placeholder="Digite seu nome" autocomplete="name" />

    <label for="presenca">VocÃª vai?</label>
    <select id="presenca" aria-label="PresenÃ§a">
      <option value="Sim">Sim! TÃ´ dentro ğŸ˜ğŸ”¥</option>
      <option value="NÃ£o">NÃ£o vou conseguir ir ğŸ˜”</option>
    </select>

    <label for="recado">Deixe um recado:</label>
    <textarea id="recado" rows="3" placeholder="Ex: Chego mais tarde..."></textarea>

    <button type="button" id="confirm-btn">Confirmar PresenÃ§a</button>

    <h2 style="margin-bottom:10px;">ConfirmaÃ§Ãµes (<span id="contador">0</span>)</h2>
    <div id="lista" aria-live="polite"></div>

    <noscript><p style="color:#ffd59a;">Para confirmar presenÃ§a ative o JavaScript no seu navegador.</p></noscript>
  </div>
</div>

<script>
  // UtilitÃ¡rio para criar cards de forma segura (sem innerHTML com valores do usuÃ¡rio)
  function criarCard(item, index) {
    const card = document.createElement("div");
    card.className = "card item";

    const nomeEl = document.createElement("strong");
    nomeEl.textContent = item.nome;

    const separador = document.createTextNode(" â€” ");

    const presencaEl = document.createElement("em");
    presencaEl.textContent = item.presenca;

    const br = document.createElement("br");

    const recadoEl = document.createElement("p");
    recadoEl.textContent = item.recado || "";

    const del = document.createElement("div");
    del.className = "deleteBtn";
    del.textContent = "Apagar";
    del.setAttribute("role", "button");
    del.tabIndex = 0;
    del.addEventListener("click", () => apagar(index));
    del.addEventListener("keypress", (e) => { if (e.key === "Enter" || e.key === " ") apagar(index); });

    card.appendChild(nomeEl);
    card.appendChild(separador);
    card.appendChild(presencaEl);
    card.appendChild(br);
    card.appendChild(recadoEl);
    card.appendChild(del);

    return card;
  }

  // Carrega confirmados e atualiza a lista/contador
  function carregar() {
    const dados = JSON.parse(localStorage.getItem("confirmados")) || [];
    const lista = document.getElementById("lista");
    lista.innerHTML = "";
    document.getElementById("contador").innerText = dados.length;

    dados.forEach((item, index) => {
      lista.appendChild(criarCard(item, index));
    });
  }

  // Confirma presenÃ§a e dÃ¡ feedback
  function confirmar() {
    const nome = document.getElementById("nome").value.trim();
    const presenca = document.getElementById("presenca").value;
    const recado = document.getElementById("recado").value.trim();
    const emojis = ["ğŸ–", "ğŸº", "ğŸ¶", "ğŸ”¥", "ğŸ˜„", "ğŸ¥©", "ğŸ‰"];
    const emoji = emojis[Math.floor(Math.random() * emojis.length)];

    if (!nome) {
      alert("Coloca seu nome aÃ­, pÃ´! ğŸ˜„");
      document.getElementById("nome").focus();
      return;
    }

    const dados = JSON.parse(localStorage.getItem("confirmados")) || [];
    dados.push({ nome, presenca, recado });
    try {
      localStorage.setItem("confirmados", JSON.stringify(dados));
    } catch (e) {
      alert("NÃ£o foi possÃ­vel salvar localmente. Verifique o espaÃ§o do navegador.");
    }

    document.getElementById("nome").value = "";
    document.getElementById("recado").value = "";

    carregar();
    alert(`ğŸ‰ PresenÃ§a confirmada! Valeu por avisar ${emoji}`);
  }

  // Apaga uma confirmaÃ§Ã£o pelo Ã­ndice
  function apagar(index) {
    const dados = JSON.parse(localStorage.getItem("confirmados")) || [];
    if (index < 0 || index >= dados.length) return;
    if (!confirm("Deseja realmente apagar esta confirmaÃ§Ã£o?")) return;
    dados.splice(index, 1);
    localStorage.setItem("confirmados", JSON.stringify(dados));
    carregar();
  }

  // Contagem regressiva atÃ© o evento
  function atualizarContagemRegressiva() {
    const evento = new Date("2025-12-13T19:00:00");
    const agora = new Date();
    const diff = evento - agora;

    const el = document.getElementById("countdown");
    if (diff <= 0) {
      el.innerText = "ğŸ‰ JÃ¡ comeÃ§ou!";
      return;
    }

    const dias = Math.floor(diff / (1000 * 60 * 60 * 24));
    const horas = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutos = Math.floor((diff / (1000 * 60)) % 60);
    const segundos = Math.floor((diff / 1000) % 60);

    el.innerText = `â³ Faltam ${dias}d ${horas}h ${minutos}m ${segundos}s`;
  }

  // BotÃ£o para tocar mÃºsica a partir de 30s (evita bloqueio de autoplay)
  function playMusica() {
    const musica = document.getElementById("musica");
    const btn = document.getElementById("play-music-btn");

    function trySeekAndPlay() {
      try {
        if (typeof musica.duration === "number" && isFinite(musica.duration) && musica.duration > 0) {
          // tenta pular para 30s se o arquivo for longo o suficiente
          musica.currentTime = Math.min(30, musica.duration - 0.1);
        } else {
          musica.currentTime = 0;
        }
      } catch (e) {
        // alguns navegadores sÃ³ permitem setar currentTime apÃ³s metadata carregada
      }
      musica.play().then(() => {
        btn.setAttribute("aria-pressed", "true");
        btn.textContent = "â¸ï¸ Pausar MÃºsica";
      }).catch(() => {
        alert("Seu navegador bloqueou o Ã¡udio. Tente clicar novamente.");
      });
    }

    if (!isFinite(musica.duration) || musica.duration === 0) {
      musica.addEventListener("loadedmetadata", trySeekAndPlay, { once: true });
    } else {
      trySeekAndPlay();
    }

    // toggle para pausar se jÃ¡ tocando
    btn.addEventListener("click", () => {
      if (!musica.paused) {
        musica.pause();
        btn.setAttribute("aria-pressed", "false");
        btn.textContent = "â–¶ï¸ Tocar MÃºsica";
      } else {
        // tenta tocar normalmente sem seek adicional
        musica.play().then(() => {
          btn.setAttribute("aria-pressed", "true");
          btn.textContent = "â¸ï¸ Pausar MÃºsica";
        }).catch(() => {
          alert("Seu navegador bloqueou o Ã¡udio. Tente clicar novamente.");
        });
      }
    });
  }

  // InicializaÃ§Ã£o - listeners
  document.getElementById("confirm-btn").addEventListener("click", confirmar);
  // TambÃ©m permite confirmar com Ctrl/Cmd+Enter no campo 'recado'
  document.getElementById("recado").addEventListener("keydown", (e) => { if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) confirmar(); });

  // configura o botÃ£o de mÃºsica para primeiro clique inicializador
  document.getElementById("play-music-btn").addEventListener("click", playMusica, { once: true });

  carregar();
  atualizarContagemRegressiva();
  setInterval(atualizarContagemRegressiva, 1000);
</script>

</body>
</html>
